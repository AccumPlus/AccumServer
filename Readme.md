# AccumServer

Очень, очень простой сервер (просто приёмо-передатчик).

## Сборка

Для сборки необходимо наличие компилятора g++ с поддержкой C++11.

### Стандартный вариант сборки:

```
make install
```

Создаст в каталоге проекта каталог bin с бинарными файлами, необходимыми для запуска отладочной версии сервера (AccumServer_debug).

### Сборка релизной версии:

```
make install build_type=release
```

Аналогична предыдущему варианту, но запускающий бинарный файл - AccumServer. В этой версии уменьшено количество выводимой информации.

### Смена каталога сборки по умолчанию

Для изменения каталога сборки укажите переменную bin_dir:
```
make install bin_dir=/other/directory
```

## Использование

Чтобы активировать сервер запустите файл AccumServer(_debug). При запуске приложение читает файл accumserver.json в катаоге запуска.
Чтобы сервер работал в режиме демона, при запуске укажите флаг -d.

Пример файла accumserver.json с комментариями:

```
{
	"ipAddress":"192.168.0.221",		- ip адрес, подключения к которому будет слушать сервер
	"port":1028,						- порт, который будет прослушиваться сервером
	"maxClientsNum":5,					- максимальное число активных подключений
	"pipePath":"pipes",					- путь к каталогу, в котором будут создаваться каналы общения
	"blacklist":[						- чёрный список - список ip адресов, которым нельзя подключаться. При наличии непустого белого списка опция неактивна
	],
	"whitelist":[						- белый список - список ip которым можно подключаться. Остальным нельзя.
		"192.168.0.17"
	],
	"workProgram":{
		"program":"main.py",			- путь к программе, обрабатывающей клиентские запросы
		"args":[						- аргументы обрабатывающей программы
		]
	},
	"reuseAddr":1,						- флаг для возможности перезапуска без ожидания освобождения порта
	"logfile":"accumserver.log"			- путь к файлу логирования
}
```

## Обрабатывающая программа

Представленный сервер не занимается обработкой принимаемых данных. После приёма блока данных он передаёт их в именованный канал и ожидает получить ответ из другого именованного канала. На другом конце каналов должна находиться обрабатывающая программа, настроенная на эти каналы.

Название каналов формируется по следующим шаблонам:
```
inputPipe_PID	для входящих сообщений
outputPipe_PID	для исходящих сообщений
```
где PID - идентификатор процесса

Пример исходного кода обрабатывающей программы на языке Python3 представлен в файле main.py
